name: Manual deploy Docker Ext-Tools
on:
  workflow_dispatch:
    inputs:
      branch:
        description: "The branch, tag or SHA of the source code to build docker."
        type: string
        required: true
      tag:
        description: "The tag for the new docker."
        type: string
        required: true


jobs:
  deploy-ext-tools-hub:
    name: Push Docker image
    runs-on: ${{ vars.UBUNTU_VERSION }}
    steps:
      - name: "Checkout optional repo"
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.branch }}
      - name: Chmod
        run: "find build -regex '.*sh' | while read file ; do chmod u+x $file ; done"
      - uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_HUB_USER }}
          password: ${{ secrets.DOCKER_HUB_PASSWORD }}
          logout: true
      - name: Deploy in Docker Hub
        run: python3 ./opencga-app/app/cloud/docker/docker-build.py push --images ext-tools --tag ${{ inputs.tag }} --org opencb