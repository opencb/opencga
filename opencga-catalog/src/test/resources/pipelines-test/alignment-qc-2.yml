id: "alignment-qc"
description: "Alignment quality control (QC) parameters. It computes: stats, flag stats, fastqc and hybrid-selection metrics. The BAM file is mandatory ever but the BED file and the dictionary files are only mandatory for computing hybrid-selection (HS) metrics. In order to skip some metrics, use the following keywords (separated by commas): stats, flagstats, fastqc and hsmetrics"
config:
  retry: 2
  timeout: 3600
jobs:
  alignment-stats:
    description: PIPELINE(description)
    params:
      file: EXECUTION(params.bamFile)
      DESCRIPTION: FETCH_FIELD(file, path, EXECUTION(params.bamFile), bioformat)
      other: FETCH_FIELD(file, bioformat, EXECUTION(jobs[tool.id=alignment-stats].params.DESCRIPTION), name)
    when:
      comparator: OR
      message: "This is my message"
      checks:
        - COMPARE_STRING(EXECUTION(jobs[tool.id=alignment-stats].params.DESCRIPTION), hello-world, !=)
#        - COMPARE_STRING(JOB(params.DESCRIPTION), hello-world, !=))
        - EXISTS(EXECUTION(jobs[tool.id=alignment-stats].params.DESCRIPTION), true)
  alignment-flagstats:
    params:
      #      file2: $JOB.alignment-stats.OUTPUT.BAM
      #      file3: FILE:BAM
      file: EXECUTION(params.bamFile)
  alignment-fastqcmetrics:
    params:
      file: EXECUTION(params.bamFile)
  alignment-hsmetrics:
    description: "alignment-stats uuid: EXECUTION(jobs[tool.id=alignment-stats].uuid)"
    dependsOn:
      - "alignment-stats"
